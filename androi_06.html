<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thực Hành Bài Tập Android</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e0ffe0; /* Light green background */
            color: #333;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: #ffffff;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(0, 128, 0, 0.1); /* Light green shadow */
            max-width: 900px;
            width: 100%;
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .start-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
            gap: 25px;
        }
        .start-screen h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2e8b57;
            margin-bottom: 10px;
        }
        .start-screen p {
            font-size: 1.1rem;
            color: #555;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .android-icon {
            width: 100px; /* Size of Android icon */
            height: 100px;
            fill: #4CAF50; /* Green color for Android icon */
            margin-bottom: 20px;
        }
        .start-button {
            background-color: #4CAF50; /* Green button */
            color: white;
            padding: 15px 35px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.25rem;
            font-weight: 700;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 6px 12px rgba(0, 128, 0, 0.3);
        }
        .start-button:hover {
            background-color: #45a049;
            transform: translateY(-3px);
        }
        .start-button:active {
            transform: translateY(0);
            box-shadow: 0 3px 6px rgba(0, 128, 0, 0.2);
        }

        .question-card {
            background-color: #f0fff0; /* Very light green background for questions */
            border: 1px solid #c0e0c0; /* Light green border */
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 8px rgba(0, 128, 0, 0.05);
        }
        .question-text {
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2e8b57; /* Dark green for question text */
        }
        .answer-option {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }
        .answer-option:hover {
            background-color: #e6ffe6; /* Light green hover */
        }
        .answer-option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.2); /* Enlarge radio button */
            accent-color: #2e8b57; /* Green color for radio button */
        }
        .answer-text {
            font-size: 1rem;
            color: #444;
        }
        .feedback-message {
            margin-top: 15px;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            display: none; /* Hidden by default */
        }
        .feedback-correct {
            background-color: #d4edda; /* Light green background */
            color: #155724; /* Dark green text */
            border: 1px solid #c3e6cb;
        }
        .feedback-incorrect {
            background-color: #f8d7da; /* Light red background */
            color: #721c24; /* Dark red text */
            border: 1px solid #f5c6cb;
        }
        .correct-answer-highlight {
            background-color: #d4edda !important; /* Light green, use !important to override hover */
            border: 1px solid #28a745;
        }
        .incorrect-answer-highlight {
            background-color: #f8d7da !important; /* Light red */
            border: 1px solid #dc3545;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .next-button, .reset-button-quiz { /* Renamed reset-button to avoid conflict */
            background-color: #2e8b57; /* Green */
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 5px 10px rgba(0, 128, 0, 0.2);
        }
        .next-button:hover, .reset-button-quiz:hover {
            background-color: #28a745;
            transform: translateY(-2px);
        }
        .next-button:active, .reset-button-quiz:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 128, 0, 0.2);
        }

        .result-section {
            background-color: #f0fff0;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #c0e0c0;
            margin-top: 20px;
            display: none; /* Hidden by default */
        }
        .result-section h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2e8b57;
            margin-bottom: 20px;
            text-align: center;
        }
        .incorrect-question-summary {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #ccc;
        }
        .incorrect-question-summary:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .incorrect-question-summary .question-text-summary {
            font-size: 1.05rem;
            color: #dc3545; /* Red for incorrect question */
        }
        .incorrect-question-summary .your-answer-summary, .incorrect-question-summary .correct-answer-summary {
            font-size: 0.95rem;
            margin-top: 5px;
            padding-left: 10px;
        }
        .incorrect-question-summary .your-answer-summary {
            color: #ffc107; /* Orange-yellow for your answer */
        }
        .incorrect-question-summary .correct-answer-summary {
            color: #28a745; /* Green for correct answer */
            font-weight: 600;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            .start-screen h1 {
                font-size: 2rem;
            }
            .start-screen p {
                font-size: 1rem;
            }
            .android-icon {
                width: 80px;
                height: 80px;
            }
            .start-button {
                padding: 12px 25px;
                font-size: 1.1rem;
            }
            .question-text {
                font-size: 1rem;
            }
            .answer-option {
                padding: 8px;
            }
            .next-button, .reset-button-quiz {
                padding: 10px 20px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="start-screen" class="start-screen">
            <svg class="android-icon" viewBox="0 0 24 24">
                <path d="M16 1C13.82 1 12 2.82 12 5V7H22V5C22 2.82 20.18 1 18 1H16M6 1C3.82 1 2 2.82 2 5V7H12V5C12 2.82 10.18 1 8 1H6M2 8V22C2 22.55 2.45 23 3 23H21C21.55 23 22 22.55 22 22V8H2M6 12V18H9V12H6M15 12V18H18V12H15Z" />
            </svg>
            <h1>Bài kiểm tra Android 06!</h1>
            <p>Trang web này sẽ giúp bạn ôn luyện kiến thức về Android thông qua các câu hỏi trắc nghiệm. Các câu hỏi và đáp án sẽ được xáo trộn ngẫu nhiên mỗi lần bạn bắt đầu.</p>
            <button id="start-quiz-button" class="start-button">Làm bài ngay</button>
        </div>

        <div id="quiz-container" style="display: none;">
            <!-- Current question will be loaded here -->
        </div>
        <div id="feedback-message" class="feedback-message"></div>
        <div class="action-buttons">
            <button id="next-question" class="next-button" style="display: none;">Câu hỏi tiếp theo</button>
        </div>

        <div id="result-container" class="result-section">
            <h2>Kết quả làm bài</h2>
            <p class="text-center text-lg mb-4">Bạn đã trả lời đúng <span id="correct-count" class="font-bold text-green-600"></span> / <span id="total-questions" class="font-bold text-gray-700"></span> câu.</p>
            <div id="incorrect-answers-summary">
                <!-- Incorrect answers summary will be displayed here -->
            </div>
            <button id="reset-quiz-button" class="reset-button-quiz">Làm lại bài khác</button>
        </div>
    </div>

    <script>
        const questionsData = [
            {
                question: "SQLite là gì?",
                options: [
                    "Một ngôn ngữ lập trình",
                    "Một trình biên dịch",
                    "Một cơ sở dữ liệu",
                    "Một hệ quản trị cơ sở dữ liệu quan hệ"
                ],
                correctAnswer: "Một hệ quản trị cơ sở dữ liệu quan hệ"
            },
            {
                question: "Khi sử dụng SQLiteOpenHelper để quản lý cơ sở dữ liệu, phương thức onCreate() được gọi khi nào?",
                options: [
                    "Khi cơ sở dữ liệu bị xóa",
                    "Khi cơ sở dữ liệu được mở",
                    "Khi cơ sở dữ liệu cần được tạo mới",
                    "Khi cơ sở dữ liệu được cập nhật"
                ],
                correctAnswer: "Khi cơ sở dữ liệu cần được tạo mới"
            },
            {
                question: "Giả sử đã bị đổi tượng SQLiteDatabase đã được khởi tạo. Khi cần cập nhật tên của hủ sinh viên có id = 5 thành “John” trong bảng Students (có các cột: id, name, age), phương thức nào dưới đây được sử dụng để thực hiện trong SQLite?",
                options: [
                    `db.update("Students", contentValues, "id = ?", arrayOf("5"))`,
                    `db.update("Students", "name = John", "where id = 5", null)`,
                    `db.update("Students", "name = 'John'", 5, null)`,
                    `db.update("Students", "name", "id = 5")`
                ],
                correctAnswer: `db.update("Students", contentValues, "id = ?", arrayOf("5"))`
            },
            {
                question: "Giả sử db là đối tượng SQLiteDatabase đã khởi tạo. Để thêm sinh viên mới tên “Nam” (tuổi 22) vào bảng Students (cột: id, name, age), đoạn mã nào dưới đây là chính xác?",
                options: [
                    `val values = ContentValues()values.put("name", "Nam")values.put("age", 22)db.execSQL("INSERT INTO Students VALUES(null, values)")`,
                    `val values = ContentValues()values.put("name", "Nam")values.put("age", 22)`, // This is an incomplete option, assuming B is the start of the next option or a typo
                    `val values = ContentValues()values.put("name", "Nam")values.put("age", 22)db.rawQuery("INSERT INTO Students(name, age) VALUES(?, ?)", arrayOf("Nam", "22"))`,
                    `val values = ContentValues()values.put("name", "Nam")values.put("age", 22)db.insert("Students", null, values)`
                ],
                correctAnswer: `val values = ContentValues()values.put("name", "Nam")values.put("age", 22)db.insert("Students", null, values)`
            },
            {
                question: "Điền vào chỗ trống ______ trong đoạn mã dưới đây để cập nhật tên của sinh viên có id = 4 thành 'Minh'?",
                options: [
                    "get, change",
                    "put, modify",
                    "put, update",
                    "get, insert"
                ],
                correctAnswer: "put, update"
            },
            {
                question: "Để lấy một đối tượng SharedPreferences trong Android thì cần sử dụng phương thức nào?",
                options: [
                    "getSharedPreferences()",
                    "getDefaultSharedPreferences()",
                    "createSharedPreferences()",
                    "getPreferences()"
                ],
                correctAnswer: "getSharedPreferences()" // Assuming this is the most common and direct answer
            },
            {
                question: "Đối tượng nào được sử dụng để chỉnh sửa dữ liệu trong SharedPreferences?",
                options: [
                    "DataEditor",
                    "SharedPreferences.Handler",
                    "SharedPreferences.Editor",
                    "SharedPreferences"
                ],
                correctAnswer: "SharedPreferences.Editor"
            },
            {
                question: "Để lưu dữ liệu boolean vào SharedPreferences, phương thức nào được sử dụng?",
                options: [
                    "addBoolean()",
                    "storeBoolean()",
                    "setBoolean()",
                    "putBoolean()"
                ],
                correctAnswer: "putBoolean()"
            },
            {
                question: "Nếu một key không tồn tại trong SharedPreferences, giá trị trả về mặc định là gì?",
                options: [
                    "Exception được ném ra",
                    "Chuỗi rỗng",
                    "Null",
                    "Một giá trị mặc định do người dùng cung cấp"
                ],
                correctAnswer: "Một giá trị mặc định do người dùng cung cấp"
            },
            {
                question: "Đoạn mã dưới đây có chức năng gì?\nval prefs = getSharedPreferences('MyPrefs', MODE_PRIVATE)\nval username = prefs.getString('username', 'Guest')",
                options: [
                    "Xóa toàn bộ dữ liệu trong SharedPreferences",
                    "Lưu giá trị 'username' vào SharedPreferences",
                    "Lấy giá trị 'username' từ SharedPreferences, trả về 'Guest' nếu key không tồn tại",
                    "Xóa key 'username' khỏi SharedPreferences"
                ],
                correctAnswer: "Lấy giá trị 'username' từ SharedPreferences, trả về 'Guest' nếu key không tồn tại"
            },
            {
                question: "Nếu ứng dụng sử dụng MODE_PRIVATE khi khởi tạo SharedPreferences, điều này có ý nghĩa gì?",
                options: [
                    "File SharedPreferences chỉ có thể được truy cập bởi ứng dụng hiện tại",
                    "File SharedPreferences có thể được truy cập bởi tất cả các ứng dụng khác",
                    "File SharedPreferences sẽ được lưu trên bộ nhớ ngoài",
                    "File SharedPreferences sẽ bị xóa khi ứng dụng đóng"
                ],
                correctAnswer: "File SharedPreferences chỉ có thể được truy cập bởi ứng dụng hiện tại"
            },
            {
                question: "Trong Room, @Entity được sử dụng để làm gì?",
                options: [
                    "Định nghĩa một bảng trong cơ sở dữ liệu",
                    "Định nghĩa mối quan hệ giữa hai bảng",
                    "Định nghĩa một truy vấn SQL",
                    "Định nghĩa một cột trong bảng"
                ],
                correctAnswer: "Định nghĩa một bảng trong cơ sở dữ liệu"
            },
            {
                question: "Điền vào chỗ trống trong đoạn mã dưới đây để thêm một bản ghi mới vào bảng students?\nval values = ContentValues()\nvalues.put('name', 'Nam')\nvalues.put('age', 20)\ndb.______('students', null, values)",
                options: [
                    "insert",
                    "put",
                    "update",
                    "add"
                ],
                correctAnswer: "insert"
            },
            {
                question: "Điền vào chỗ trống trong đoạn mã dưới đây để xóa bản ghi có id = 3 trong bảng Students?  \tdb.delete('Students', 'id = ?', '3')",
                options: [
                    `array("3")`,
                    `["3"]`,
                    `listOf("3")`,
                    `arrayOf("3")`
                ],
                correctAnswer: `arrayOf("3")`
            },
            {
                question: "Đoạn mã sau thực hiện công việc gì?\nval cursor = db.rawQuery('SELECT COUNT(*) FROM users', null)\ncursor.moveToFirst()\nprintln(cursor.getInt(0))\ncursor.close()",
                options: [
                    "Xóa một bản ghi trong bảng",
                    "In ra số lượng bản ghi hiện có trong bảng",
                    "Tìm kiếm một bản ghi trong bảng",
                    "Ghi vào bảng số lượng bản ghi"
                ],
                correctAnswer: "In ra số lượng bản ghi hiện có trong bảng"
            },
            {
                question: "Giả sử bảng đối tượng SQLiteDatabase đã được khởi tạo. Để xóa sinh viên có id = 101 trong bảng Students (có cột id), câu lệnh delete() nào dưới đây là đúng?",
                options: [
                    `val rowsDeletedB = db.delete("Students", "WHERE id = 101")`,
                    `val rowsDeletedC = db.delete("Students", "id = ?", arrayOf("101"))`,
                    `val rowsDeletedD = db.delete("Students", "id = 101")`,
                    `val rowsDeletedA = db.delete("Students", "id", "101")`
                ],
                correctAnswer: `val rowsDeletedC = db.delete("Students", "id = ?", arrayOf("101"))`
            },
            {
                question: "Giả sử db là đối tượng SQLiteDatabase đã khởi tạo. Để truy vấn tất cả sinh viên có tuổi lớn hơn 18 từ bảng Students (có các cột: id, name, age), phương thức rawQuery() nào đúng đây là đúng?",
                options: [
                    `val cursor = db.rawQuery("SELECT * FROM Students WHERE age > 18;", null)`,
                    `val cursor = db.rawQuery("SELECT * FROM Students WHERE age > 18", null)`,
                    `val cursor = db.rawQuery("SELECT * FROM Students WHERE age > 18 ORDER BY age DESC", null)`,
                    `val cursor = db.rawQuery("SELECT * FROM Students WHERE age >= 18", null)`
                ],
                correctAnswer: `val cursor = db.rawQuery("SELECT * FROM Students WHERE age > 18", null)`
            },
            {
                question: "Giả sử db là đối tượng SQLiteDatabase đã khởi tạo. Để xóa sinh viên có id = 7 trong bảng Students (có các cột: id, name, age), đoạn mã nào dưới đây là chính xác?",
                options: [
                    `db.rawQuery("DELETE FROM Students WHERE id = ?", arrayOf("7"))`,
                    `db.delete("Students", "WHERE id = ?", arrayOf("7"))`,
                    `db.delete("Students", "id", arrayOf("7"))`,
                    `db.delete("Students", "id = ?", arrayOf("7"))`
                ],
                correctAnswer: `db.delete("Students", "id = ?", arrayOf("7"))`
            },
            {
                question: "Điền vào 2 chỗ trống ________ trong đoạn mã dưới đây để thêm một bản ghi mới vào bảng Students?\nval values = ContentValues()\nvalues.put('name','An')\nvalues.put('age',25)\ndb.______(___, null, values)",
                options: [
                    `add, "students"`,
                    `add, "Students"`,
                    `insert, "Students"`,
                    `insert, "student"`
                ],
                correctAnswer: `insert, "Students"`
            },
            {
                question: "Tại sao SharedPreferences không phù hợp để lưu trữ dữ liệu lớn?",
                options: [
                    "Vì SharedPreferences không được mã hóa",
                    "Vì SharedPreferences không hỗ trợ lưu trữ dữ liệu ngoài chuỗi ký tự",
                    "Vì SharedPreferences chỉ hỗ trợ lưu trữ dữ liệu nhỏ và không tối ưu về hiệu năng cho dữ liệu lớn",
                    "Vì SharedPreferences bị giới hạn kích thước file"
                ],
                correctAnswer: "Vì SharedPreferences chỉ hỗ trợ lưu trữ dữ liệu nhỏ và không tối ưu về hiệu năng cho dữ liệu lớn"
            },
            {
                question: "Điều gì xảy ra nếu gọi putString() với một key đã tồn tại trong SharedPreferences?",
                options: [
                    "Xóa giá trị cũ trước khi thêm giá trị mới",
                    "Thêm một giá trị mới với cùng key",
                    "Ném ra ngoại lệ vì key đã tồn tại",
                    "Ghi đè giá trị cũ bằng giá trị mới"
                ],
                correctAnswer: "Ghi đè giá trị cũ bằng giá trị mới"
            },
            {
                question: "Đoạn mã sau in ra kết quả gì khi bảng không chứa dữ liệu? \nval cursor = db.rawQuery('SELECT * FROM users WHERE id = 10', null)\ncursor.moveToFirst()\nprintln(cursor.count)\ncursor.close()",
                options: [
                    "0",
                    "null",
                    "10",
                    "Exception"
                ],
                correctAnswer: "0"
            },
            {
                question: "Đối tượng nào được sử dụng để thực hiện truy vấn SQL trên cơ sở dữ liệu SQLite trong Android?",
                options: [
                    "ContentValues",
                    "SQLiteOpenHelper",
                    "SQLiteDatabase",
                    "Cursor"
                ],
                correctAnswer: "SQLiteDatabase"
            },
            {
                question: "Phương thức onUpgrade trong SQLiteOpenHelper được sử dụng khi nào?",
                options: [
                    "Khi phiên bản cơ sở dữ liệu thay đổi.",
                    "Khi cơ sở dữ liệu được tạo lần đầu.",
                    "Khi thêm một cột vào bảng hiện có.",
                    "Khi truy vấn dữ liệu từ cơ sở dữ liệu."
                ],
                correctAnswer: "Khi phiên bản cơ sở dữ liệu thay đổi."
            },
            {
                question: "SharedPreferences trong Android được sử dụng chủ yếu để lưu trữ dữ liệu nào?",
                options: [
                    "Dữ liệu nhị phân lớn",
                    "Dữ liệu cấu hình và cài đặt ứng dụng",
                    "Dữ liệu từ mạng",
                    "Dữ liệu hình ảnh và video"
                ],
                correctAnswer: "Dữ liệu cấu hình và cài đặt ứng dụng"
            },
            {
                question: "Khi nào nên sử dụng SharedPreferences?",
                options: [
                    "Lưu trữ thông tin người dùng đăng nhập",
                    "Lưu trữ toàn bộ dữ liệu của ứng dụng",
                    "Lưu trữ thông tin cài đặt hoặc dữ liệu đơn giản của người dùng",
                    "Lưu trữ danh sách sản phẩm trong ứng dụng bán hàng"
                ],
                correctAnswer: "Lưu trữ thông tin cài đặt hoặc dữ liệu đơn giản của người dùng"
            },
            {
                question: "Tại sao SharedPreferences không phù hợp để lưu trữ dữ liệu lớn?",
                options: [
                    "Vì SharedPreferences bị giới hạn kích thước file",
                    "Vì SharedPreferences không hỗ trợ lưu trữ dữ liệu ngoài chuỗi ký tự",
                    "Vì SharedPreferences không được mã hóa",
                    "Vì SharedPreferences chỉ hỗ trợ lưu trữ dữ liệu nhỏ và không tối ưu về hiệu năng cho dữ liệu lớn"
                ],
                correctAnswer: "Vì SharedPreferences chỉ hỗ trợ lưu trữ dữ liệu nhỏ và không tối ưu về hiệu năng cho dữ liệu lớn"
            },
            {
                question: "Room Database hoạt động dựa trên cơ sở dữ liệu nào?",
                options: [
                    "SQLite",
                    "MySQL",
                    "Firebase Realtime Database",
                    "MongoDB"
                ],
                correctAnswer: "SQLite"
            },
            {
                question: "Đoạn mã sau tạo một cơ sở dữ liệu với tên StudentDB. Hãy điền vào chỗ trống để tạo bảng students trong cơ sở dữ liệu này:\nclass DatabaseHelper(context: Context) : SQLiteOpenHelper(context, 'StudentDB', null, 1) {\n    override fun onCreate(db: SQLiteDatabase) {\n        db._______('CREATE TABLE students (id INTEGER PRIMARY KEY, name TEXT, age INTEGER)')\n    }\n    override fun onUpgrade(db: SQLiteDatabase, oldVersion: Int, newVersion: Int) {}\n}",
                options: [
                    "query",
                    "execSQL",
                    "execute",
                    "rawQuery"
                ],
                correctAnswer: "execSQL"
            }
        ];

        let shuffledQuestions = [];
        let currentQuestionIndex = 0;
        let correctAnswersCount = 0;
        const incorrectAttemptedQuestions = []; // Stores incorrect questions for summary

        const startScreen = document.getElementById('start-screen');
        const startQuizButton = document.getElementById('start-quiz-button');
        const quizContainer = document.getElementById('quiz-container');
        const feedbackMessageDiv = document.getElementById('feedback-message');
        const nextButton = document.getElementById('next-question');
        const resultContainer = document.getElementById('result-container');
        const correctCountSpan = document.getElementById('correct-count');
        const totalQuestionsSpan = document.getElementById('total-questions');
        const incorrectAnswersSummaryDiv = document.getElementById('incorrect-answers-summary');
        const resetButtonQuiz = document.getElementById('reset-quiz-button'); // Renamed

        // Function to shuffle an array (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Function to display a specific question
        function displayQuestion(qIndex) {
            quizContainer.innerHTML = ''; // Clear old question
            feedbackMessageDiv.style.display = 'none'; // Hide feedback message
            feedbackMessageDiv.className = 'feedback-message'; // Clear old CSS classes
            nextButton.style.display = 'none'; // Hide "Next Question" button

            if (qIndex >= shuffledQuestions.length) {
                // All questions completed, show final results
                showResults();
                return;
            }

            const currentQ = shuffledQuestions[qIndex];

            const questionCard = document.createElement('div');
            questionCard.className = 'question-card';

            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.textContent = `Câu ${qIndex + 1}/${shuffledQuestions.length}: ${currentQ.question}`;
            questionCard.appendChild(questionText);

            const shuffledOptions = [...currentQ.options];
            shuffleArray(shuffledOptions); // Shuffle answer options

            shuffledOptions.forEach((option, oIndex) => {
                const optionLabel = document.createElement('label');
                optionLabel.className = 'answer-option';
                optionLabel.dataset.optionValue = option; // Store answer value in dataset

                const radioInput = document.createElement('input');
                radioInput.type = 'radio';
                radioInput.name = `current-question`;
                radioInput.value = option;
                // Add event listener for each radio button
                radioInput.addEventListener('change', (e) => handleAnswerSelection(e, currentQ, optionLabel));

                const optionText = document.createElement('span');
                optionText.className = 'answer-text';
                optionText.textContent = option;

                optionLabel.appendChild(radioInput);
                optionLabel.appendChild(optionText);
                questionCard.appendChild(optionLabel);
            });
            quizContainer.appendChild(questionCard);
        }

        // Function to handle user's answer selection
        function handleAnswerSelection(event, question, selectedLabel) {
            const userAnswer = event.target.value;
            const allOptions = quizContainer.querySelectorAll('.answer-option');
            const radioButtons = quizContainer.querySelectorAll('input[type="radio"]');

            // Disable all radio buttons to prevent changing selection
            radioButtons.forEach(radio => radio.disabled = true);

            // Show feedback message
            feedbackMessageDiv.style.display = 'block';

            if (userAnswer === question.correctAnswer) {
                correctAnswersCount++;
                feedbackMessageDiv.className = 'feedback-message feedback-correct';
                feedbackMessageDiv.textContent = '✅ Đúng rồi!';
                selectedLabel.classList.add('correct-answer-highlight');
            } else {
                feedbackMessageDiv.className = 'feedback-message feedback-incorrect';
                feedbackMessageDiv.textContent = `❌ Sai rồi. Đáp án đúng là: ${question.correctAnswer}`;
                selectedLabel.classList.add('incorrect-answer-highlight');

                // Highlight correct answer
                allOptions.forEach(option => {
                    if (option.dataset.optionValue === question.correctAnswer) {
                        option.classList.add('correct-answer-highlight');
                    }
                });

                incorrectAttemptedQuestions.push({
                    question: question.question,
                    yourAnswer: userAnswer,
                    correctAnswer: question.correctAnswer
                });
            }
            nextButton.style.display = 'block'; // Show "Next Question" button
            quizContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Function to display final results
        function showResults() {
            quizContainer.style.display = 'none'; // Hide current question
            feedbackMessageDiv.style.display = 'none'; // Hide feedback message
            nextButton.style.display = 'none'; // Hide next button

            correctCountSpan.textContent = correctAnswersCount;
            totalQuestionsSpan.textContent = shuffledQuestions.length;

            incorrectAnswersSummaryDiv.innerHTML = '';
            if (incorrectAttemptedQuestions.length > 0) {
                incorrectAttemptedQuestions.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'incorrect-question-summary';
                    div.innerHTML = `
                        <p class="question-text-summary">${item.question}</p>
                        <p class="your-answer-summary">Câu trả lời của bạn: ${item.yourAnswer}</p>
                        <p class="correct-answer-summary">Đáp án đúng: ${item.correctAnswer}</p>
                    `;
                    incorrectAnswersSummaryDiv.appendChild(div);
                });
            } else {
                incorrectAnswersSummaryDiv.innerHTML = '<p class="text-center text-green-700 font-bold">🎉 Chúc mừng! Bạn đã trả lời đúng tất cả các câu hỏi.</p>';
            }

            resultContainer.style.display = 'block';
            resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Initialize quiz: Shuffle questions and display the first one
        function initializeQuiz() {
            shuffledQuestions = [...questionsData];
            shuffleArray(shuffledQuestions);
            currentQuestionIndex = 0;
            correctAnswersCount = 0;
            incorrectAttemptedQuestions.length = 0; // Clear list of incorrect questions
            resultContainer.style.display = 'none'; // Hide results section

            // Hide quiz container and show start screen initially
            quizContainer.style.display = 'none';
            startScreen.style.display = 'flex';
        }

        // Event listener for "Start Quiz" button
        startQuizButton.addEventListener('click', () => {
            startScreen.style.display = 'none'; // Hide start screen
            quizContainer.style.display = 'block'; // Show quiz container
            displayQuestion(currentQuestionIndex); // Display the first question
            quizContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });

        // Event listener for "Next Question" button
        nextButton.addEventListener('click', () => {
            currentQuestionIndex++;
            displayQuestion(currentQuestionIndex);
        });

        // Event listener for "Reset Quiz" button (now goes back to start screen)
        resetButtonQuiz.addEventListener('click', () => {
            initializeQuiz(); // Re-initialize the quiz, which shows the start screen
            startScreen.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });

        // Load quiz for the first time when page is loaded
        document.addEventListener('DOMContentLoaded', initializeQuiz);
    </script>
</body>
</html>
